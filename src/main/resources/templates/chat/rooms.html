<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>채팅 - Topping</title>
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T5T3CSLT');</script>
    <!-- End Google Tag Manager -->

    <!-- Google tag (gtag.js) -->
    <script async src='https://www.googletagmanager.com/gtag/js?id=G-Y1ZSWHSQD0'></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-Y1ZSWHSQD0');
    </script>
    
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/chat.css}">
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src='https://www.googletagmanager.com/ns.html?id=GTM-T5T3CSLT'
    height='0' width='0' style='display:none;visibility:hidden'></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <!-- Skip to main content for accessibility -->
    <!--    <a href="#main-content" class="skip-link">메인 콘텐츠로 건너뛰기</a>-->
    
    <!-- Navigation -->
    <div th:replace="fragments/navbar :: navbar"></div>
    
    <!-- Main Content -->
    <main id="main-content" class="main-content">
        <div class="chat-container">
        <!-- Left Sidebar: Chat Room List -->
        <div class="chat-sidebar">
            <div class="chat-sidebar-header">
                <h2>채팅</h2>
                <div class="search-container">
                    <input type="text" placeholder="검색어를 입력하세요" class="search-input" id="chatSearch">
                    <span class="material-symbols-outlined search-icon">search</span>
                </div>
            </div>
            
            <div class="chat-rooms-list" id="chatRoomsList">
                <div th:each="chatRoom : ${chatRooms}" class="chat-room-item" th:data-room-id="${chatRoom.uuid}">
                    <div class="room-avatar">
                        <span th:text="${chatRoom.roomName != null and !#strings.isEmpty(chatRoom.roomName) ? chatRoom.roomName.substring(0,1).toUpperCase() : 'C'}">C</span>
                    </div>
                    <div class="room-info">
                        <div class="room-name" th:text="${chatRoom.roomName != null ? chatRoom.roomName : '채팅방'}">채팅방 이름</div>
                        <div class="room-preview" th:text="${chatRoom.displayPreview}">메시지 내용</div>
                    </div>
                    <div class="room-meta">
                        <div class="room-time" 
                             th:text="${chatRoom.formattedTime}"
                             th:title="${chatRoom.displayTime != null ? #temporals.format(chatRoom.displayTime, 'yyyy년 M월 d일 a h:mm', #locale) : ''}">오후 12:31</div>
                        <div class="unread-badge" 
                             th:if="${chatRoom.unreadCount != null and chatRoom.unreadCount > 0}"
                             th:text="${chatRoom.unreadCount}"
                             th:classappend="${chatRoom.unreadCount == null or chatRoom.unreadCount == 0} ? 'hidden' : ''"
                             th:attr="aria-label='읽지 않은 메시지 ' + ${chatRoom.unreadCount} + '개'"
                             role="status">
                        </div>
                    </div>
                </div>
            </div>
            
            <div th:if="${#lists.isEmpty(chatRooms)}" class="empty-state">
                <div class="empty-icon">
                    <span class="material-symbols-outlined">chat</span>
                </div>
                <h4>활성 채팅방이 없습니다</h4>
                <p>협업 제안이 수락되면 채팅방이 생성됩니다.</p>
                <div class="empty-actions">
                    <a href="/proposals/suggest" class="btn btn-primary">협업 제안하기</a>
                    <a href="/proposals/browse" class="btn btn-outline">제안 둘러보기</a>
                </div>
            </div>
        </div>
        
        <!-- Right Panel: Chat Interface -->
        <div class="chat-main" id="chatMain">
            <div class="chat-placeholder">
                <div class="placeholder-icon">
                    <span class="material-symbols-outlined">forum</span>
                </div>
                <h3>채팅방을 선택하세요</h3>
                <p>왼쪽에서 채팅방을 선택하여 대화를 시작하세요.</p>
            </div>
        </div>
        </div>
    </main>
    
    <!-- Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>
    
    <!-- WebSocket Libraries - Modern STOMP client -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
    
    <script th:src="@{/js/common.js}"></script>
    <script th:src="@{/js/chat.js}"></script>
    <script th:src="@{/js/sidebar.js}"></script>
</body>
</html>