<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${store.name} + ' - 토핑'">가게 상세 - 토핑</title>

    <!-- Optimized CSS Framework -->
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/store-detail-refactored.css}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">

    <!-- Performance Optimizations -->
    <meta name="user-authenticated" th:content="${#authorization.expression('isAuthenticated()')}" />
    <link rel="preload" th:href="@{/js/store-detail-optimized.js}" as="script">
    <link rel="preload" th:href="${store.mainImage != null ? store.mainImage.imagePath : '/image/topping_L.png'}" as="image">
</head>
<body class="store-detail-body" th:attr="data-authenticated=${#authorization.expression('isAuthenticated()')}">
<a href="#main-content" class="skip-link">메인 콘텐츠로 건너뛰기</a>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<main id="main-content" class="main-content">
    <div class="container">

        <!-- 1️⃣ Hero Section with Background Image -->
        <section class="hero-section"
                 th:style="'background-image: url(' + (${store.mainImage != null ? store.mainImage.imagePath : (store.mainImageUrl != null ? store.mainImageUrl : '/image/topping_L.png')}) + ');'">
            <div class="hero-overlay"></div>
            <div class="hero-content grid-2">
                <!-- Left Column: Store Information -->
                <div class="store-info flex-col">
                    <div th:replace="~{fragments/tag :: category(${store.category})}"></div>
                    <h1 class="heading-hero text-white" th:text="${store.name}">에펠루아 본점</h1>
                    <div class="rating-section flex-center" style="justify-content: flex-start;">
                        <span class="rating">⭐ <span th:text="${rating}">4.9</span></span>
                        <span class="text-white-80">(<span th:text="${reviewCount}">1,114</span>)</span>
                    </div>
                    <div class="flex-center text-white-90" style="justify-content: flex-start;">
                        <span class="material-symbols-outlined">location_on</span>
                        <span th:text="${store.address}">강릉시 창해로 361-77</span>
                    </div>
                    <div th:if="${!store.hashtags.empty}" th:replace="~{fragments/tag :: hashtag-group(${store.hashtags})}"></div>
                    <div th:if="${store.hashtags.empty}" th:replace="~{fragments/tag :: default-hashtag}"></div>
                    <div class="social-stats flex-wrap">
                        <button class="btn-base btn-hero like-btn">
                            <span class="material-symbols-outlined">thumb_up</span>
                            <span th:text="${likeCount}">23</span>
                        </button>
                        <button class="btn-base btn-hero wishlist-btn">
                            <span class="material-symbols-outlined">favorite</span>
                            <span th:text="${wishlistCount}">1,115</span>
                        </button>
                    </div>
                </div>

                <!-- Right Column: Large Image Display -->
                <div class="flex-center">
                    <img th:if="${store.mainImage != null}"
                         th:src="${store.mainImage.imagePath}"
                         th:alt="${store.name}"
                         class="image-hero gallery-trigger"
                         data-index="0"
                         loading="eager" />
                    <img th:if="${store.mainImage == null and store.mainImageUrl != null}"
                         th:src="${store.mainImageUrl}"
                         th:alt="${store.name}"
                         class="image-hero gallery-trigger"
                         data-index="0"
                         loading="eager" />
                    <img th:if="${store.mainImage == null and store.mainImageUrl == null}"
                         th:src="@{/image/topping_L.png}"
                         th:alt="${store.name}"
                         class="image-hero gallery-trigger"
                         data-index="0"
                         loading="eager" />
                </div>
            </div>
        </section>

        <!-- 2️⃣ Gallery Section (가게 사진) -->
        <section class="section">
            <h2 class="heading-lg text-dark">가게 사진</h2>
            <p class="text-base text-medium" style="margin-bottom: 24px;">가게의 분위기를 확인할 수 있어요.</p>

            <div th:if="${!store.images.empty}" class="gallery-scroll">
                <div class="image-gallery gallery-trigger"
                     th:each="image, iterStat : ${store.images}"
                     th:attr="data-index=${iterStat.index}">
                    <img th:src="${image.imagePath}"
                         th:alt="${image.imageType.displayName}"
                         th:title="${image.imageType.displayName}"
                         loading="lazy" />
                </div>
            </div>

            <div th:if="${store.images.empty}" class="empty-state">
                <p>아직 등록된 이미지가 없습니다.</p>
            </div>
        </section>

        <!-- 3️⃣ Menu Section 1: 콜라보 인기 메뉴 -->
        <section class="section">
            <h2 class="heading-lg text-dark">콜라보 인기 메뉴</h2>
            <p class="text-base text-medium" style="margin-bottom: 24px;">고객들이 사랑하는 메뉴예요.</p>

            <div th:if="${!#lists.isEmpty(popularMenus)}" class="grid-3">
                <th:block th:each="product : ${popularMenus}">
                    <div th:replace="~{fragments/product-card :: card(${product})}"></div>
                </th:block>
            </div>

            <div th:if="${#lists.isEmpty(popularMenus)}" class="empty-state">
                <p>아직 등록된 인기 상품이 없습니다.</p>
            </div>
        </section>

        <!-- 3️⃣ Menu Section 2: 시그니처 메뉴 -->
        <section class="section">
            <h2 class="heading-lg text-dark">시그니처 메뉴</h2>
            <p class="text-base text-medium" style="margin-bottom: 24px;">이 가게만의 특별한 메뉴예요.</p>

            <div th:if="${!#lists.isEmpty(signatureMenus)}" class="grid-3">
                <th:block th:each="product : ${signatureMenus}">
                    <div th:replace="~{fragments/product-card :: card(${product})}"></div>
                </th:block>
            </div>

            <div th:if="${#lists.isEmpty(signatureMenus)}" class="empty-state">
                <p>아직 등록된 시그니처 상품이 없습니다.</p>
            </div>
        </section>

    </div>
</main>

<!-- 4️⃣ Fixed Action Bar -->
<div class="action-bar">
    <div class="action-bar-content flex-between">
        <button class="btn-base btn-primary collaboration-btn">
            콜라보 요청하기
        </button>
        <div class="action-buttons flex-center">
            <button class="btn-base btn-action wishlist-btn" th:attr="data-store-id=${store.uuid}">
                <span class="material-symbols-outlined">favorite</span>
            </button>
            <button class="btn-base btn-action share-btn">
                <span class="material-symbols-outlined">share</span>
            </button>
        </div>
    </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>
<div th:replace="~{fragments/modals :: policy-modals}"></div>
<div th:replace="~{fragments/modals :: confirmation-modal}"></div>

<!-- Optimized Scripts -->
<script th:src="@{/js/common.js}" defer></script>
<script th:src="@{/js/store-detail-optimized.js}" defer></script>
</body>
</html>
