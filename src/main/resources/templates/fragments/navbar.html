<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <!-- icon-->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
          rel="stylesheet"/>
    <style>
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined';
            font-weight: 400;
            font-style: normal;
            font-size: 48px;
            display: inline-block;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            white-space: nowrap;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
            font-variation-settings: 'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 48;
        }
    </style>
</head>
<body>
<!-- Sidebar Navigation Fragment -->
<div th:fragment="navbar">
    <!-- Immediate JavaScript for mobile toggle -->
    <script>
        // Immediate function definition to prevent timing issues
        window.toggleMobileSidebar = function() {
            console.log('toggleMobileSidebar called');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const toggle = document.getElementById('mobileMenuToggle');
            
            if (sidebar) {
                const isActive = sidebar.classList.contains('active');
                console.log('Sidebar is currently active:', isActive);
                
                if (isActive) {
                    sidebar.classList.remove('active');
                    if (overlay) overlay.classList.remove('active');
                    if (toggle) toggle.classList.remove('active');
                    document.body.style.overflow = '';
                    console.log('Sidebar closed');
                } else {
                    sidebar.classList.add('active');
                    if (overlay) overlay.classList.add('active');
                    if (toggle) toggle.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    console.log('Sidebar opened');
                }
            } else {
                console.error('Sidebar element not found');
            }
        };
        
        // Also set as toggleSidebar for consistency
        window.toggleSidebar = window.toggleMobileSidebar;
    </script>
    
    <!-- Mobile Menu Toggle Button -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileSidebar();">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
    </button>

    <!-- Sidebar Overlay for mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleMobileSidebar()"></div>

    <!-- Main Sidebar -->
    <nav class="sidebar" id="sidebar">
        <!-- Logo Section -->
        <div class="sidebar-logo">
            <a href="/" class="logo-link">
                <img th:src="@{/image/topping_S.png}" alt="ÌÜ†Ìïë" class="logo-image" onerror="this.src='/image/topping_M_text.png'">
                <!--                <span class="logo-text">ÌÜ†Ìïë</span>-->
            </a>
        </div>

        <!-- Navigation Menu -->
        <div class="sidebar-menu">
            <ul class="menu-list">
                <li class="menu-item">
                    <a href="/" class="menu-link home-link"
                       th:classappend="${#httpServletRequest != null and (#httpServletRequest.requestURI == '/' or #httpServletRequest.requestURI == '/home') ? 'active' : ''}">
<!--                        <span class="material-symbols-outlined">home</span>-->
                        <img th:src="@{/image/sidebar/icon_home_default.png}" 
                             alt="Home" 
                             class="menu-icon" 
                             data-default="/image/sidebar/icon_home_default.png" 
                             data-pressed="/image/sidebar/icon_home_pressed.png"
                             data-menu="home">
                    </a>
                </li>
                <li class="menu-item">
                    <a href="/explore" class="menu-link"
                       th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.startsWith('/explore') ? 'active' : ''}">
<!--                        <span class="material-symbols-outlined">handshake</span>-->
                        <img th:src="@{/image/sidebar/icon_collabo_default.png}" 
                             alt="collabo" 
                             class="menu-icon" 
                             data-default="/image/sidebar/icon_collabo_default.png" 
                             data-pressed="/image/sidebar/icon_collabo_pressed.png"
                             data-menu="explore">
                    </a>
                </li>
                <li class="menu-item">
                    <a href="/chat/rooms" class="menu-link"
                       th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.startsWith('/chat') ? 'active' : ''}">
<!--                        <span class="material-symbols-outlined"> chat </span>-->
                        <img th:src="@{/image/sidebar/icon_chat_default.png}"
                             alt="chat"
                             class="menu-icon"
                             data-default="/image/sidebar/icon_chat_default.png"
                             data-pressed="/image/sidebar/icon_chat_pressed.png"
                             data-menu="chat">
                        <!--<span class="material-symbols-outlined"> mark_unread_chat_alt</span>-->
<!--                        <img src="image/sidebar/icon_collabo_default.png" alt="Home" class="menu-icon">-->
                    </a>

                </li>
                <li class="menu-item">
                    <a href="/mypage" class="menu-link"
                       th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.startsWith('/mypage') ? 'active' : ''}">
<!--                        <span class="material-symbols-outlined">person</span>-->
                        <img th:src="@{/image/sidebar/icon_mypage_default.png}" 
                             alt="MyPage" 
                             class="menu-icon" 
                             data-default="/image/sidebar/icon_mypage_default.png" 
                             data-pressed="/image/sidebar/icon_mypage_pressed.png"
                             data-menu="mypage">
                    </a>
                </li>
<!--                <li class="menu-item">-->
<!--                    <a href="/updates" class="menu-link"-->
<!--                       th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.startsWith('/updates') ? 'active' : ''}">-->
<!--                        <span class="material-symbols-outlined">article</span>-->
<!--                    </a>-->
<!--                </li>-->
                <li class="menu-item">
                    <a href="/signup/step/1" class="menu-link"
                       th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.startsWith('/signup') ? 'active' : ''}">
<!--                        <span class="material-symbols-outlined">person_add</span>-->
                        <img th:src="@{/image/sidebar/icon_join_default.png}" 
                             alt="Join" 
                             class="menu-icon" 
                             data-default="/image/sidebar/icon_join_default.png" 
                             data-pressed="/image/sidebar/icon_join_pressed.png"
                             data-menu="signup">
                    </a>
                </li>
            </ul>
        </div>

        <!-- Authentication Section -->
        <div class="sidebar-auth">
            <!-- Show login/signup for unauthenticated users -->
            <th:block sec:authorize="!isAuthenticated()">
                <a href="/auth/login" class="auth-link login-link"
                   th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.startsWith('/auth/login') ? 'active' : ''}">
                    <i class="auth-icon">üîë</i>
                    <span class="auth-text">Î°úÍ∑∏Ïù∏</span>
                </a>
                <a href="/signup/step/1" class="auth-link signup-link"
                   th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.startsWith('/auth/signup') ? 'active' : ''}">
                    <i class="auth-icon">üìù</i>
                    <span class="auth-text">ÌöåÏõêÍ∞ÄÏûÖ</span>
                </a>
            </th:block>

            <!-- Show logout for authenticated users -->
            <th:block sec:authorize="isAuthenticated()">
                <a href="/logout" class="auth-link logout-link"
                   onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
                    <i class="auth-icon">üö™</i>
                    <span class="auth-text">Î°úÍ∑∏ÏïÑÏõÉ</span>
                </a>

                <!-- Hidden logout form -->
                <form id="logout-form" action="/logout" method="post" style="display: none;">
                </form>
            </th:block>
        </div>
    </nav>
</div>
</body>
</html>